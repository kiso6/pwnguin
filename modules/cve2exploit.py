#!/usr/bin/env python3

from pymetasploit3.msfconsole import MsfRpcConsole
from pymetasploit3.msfrpc import MsfRpcClient

import subprocess
import json
import time
import pprint

# process = Popen(["msfrpcd" , "-P",  "yourpassword"], stdout=PIPE, stderr=PIPE)
# stdout, stderr = process.communicate()


# Connect to `msfrpcd`
def getexploit(cve_list, client: MsfRpcClient):
    """Search for Metasploit modules that match the given CVEs"""

    print("[i] Starting process to match service names to modules...")
    potential_module_matches = []
    for cve in cve_list:
        modules = client.modules.search("type:exploit cve:" + cve)
        if modules:
            print(cve + "\n")
            potential_module_matches.append(modules)

    if potential_module_matches != []:
        print(f"[+] Potential Relevant Modules:\n\n{potential_module_matches}\n\n")
    else:
        print("[X] No metasploit module matching for this CVE.")
    return potential_module_matches
